<!DOCTYPE html>
<html>

<head>
    <title>Music Player</title>
    <link rel="icon" href="/static/logo/music.png" type="image/x-icon">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f5f5f5;
        }

        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .playing {
            background-color: #e8f5e9;
        }

        #audioPlayer {
            width: 100%;
            margin-top: 20px;
        }

        .error-message {
            color: red;
            padding: 10px;
            background-color: #ffebee;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #666;
        }
    </style>
    <!-- Thêm Axios từ CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.7/axios.min.js"></script>
</head>

<body>
    <div id="errorMessage" class="error-message"></div>
    <div id="loading" class="loading">Đang tải danh sách bài hát...</div>

    <table id="musicTable">
        <thead>
            <tr>
                <th>STT</th>
                <th>Tên bài hát</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody id="musicList"></tbody>
    </table>
    <audio id="audioPlayer" controls style="display: none;"></audio>

    <script>
        const musicList = document.getElementById('musicList');
        const audioPlayer = document.getElementById('audioPlayer');
        const errorMessage = document.getElementById('errorMessage');
        const loadingMessage = document.getElementById('loading');
        let currentPlayingRow = null;

        // Hàm hiển thị lỗi
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            loadingMessage.style.display = 'none';
        }

        // Hàm phát nhạc
        function playSong(path, button) {
            // Xóa highlight của bài hát đang phát trước đó
            if (currentPlayingRow) {
                currentPlayingRow.classList.remove('playing');
            }

            // Highlight bài hát đang phát
            currentPlayingRow = button.closest('tr');
            currentPlayingRow.classList.add('playing');

            // Cập nhật source và phát nhạc
            audioPlayer.src = path;
            audioPlayer.style.display = 'block';
            audioPlayer.play();
        }

        // Xử lý khi bài hát kết thúc
        audioPlayer.addEventListener('ended', () => {
            if (currentPlayingRow) {
                currentPlayingRow.classList.remove('playing');
            }
        });

        // Lấy dữ liệu từ API
        axios.get("/music")
            .then(response => {
                const songs = response.data;
                loadingMessage.style.display = 'none';

                songs.forEach(song => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${song.stt}</td>
                        <td>${song.name}</td>\
                        <td><button onclick="playSong('${song.path}', this)">Phát</button></td>
                    `;
                    musicList.appendChild(row);
                });
            })
            .catch(err => {
                showError(`Lỗi khi tải danh sách bài hát: ${err.message}`);
            });
    </script>
</body>

</html>